<script>
window.MathJax = {
  tex: {
    inlineMath: [['$', '$'], ['\\(', '\\)']],
    displayMath: [['$$', '$$'], ['\\[', '\\]']],
    macros: {
      oiint: "{\\mathchoice{\\mkern-18mu\\iint}{\\mkern-12mu\\iint}{\\mkern-13mu\\iint}{\\mkern-12mu\\iint}}"
    }
  }
};
</script>
<script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script>

# 四、总线与输入输出系统



## 4.1 总线系统



### 总线基本概念



**总线组成**：

* **数据总线**：传输数据，双向

* **地址总线**：传输地址，单向（CPU→外设）

* **控制总线**：传输控制信号，双向



**总线带宽计算**（2009）：

$B = f \times w \times \eta$

$f$：时钟频率，$w$：数据线宽度（字节），$\eta$：传输效率



**总线仲裁**：

* **集中式仲裁**：

    * 链式查询：简单，优先级固定，对故障敏感

    * 计数器定时查询：优先级可编程

    * 独立请求：速度快，控制线多

* **分布式仲裁**：各设备竞争总线



**总线定时**：

* **同步定时**（2014）：时钟信号同步

* **异步定时**（2014）：握手信号同步

    * 全互锁（2015）：可靠，速度慢

    * 非互锁（2015）：速度快，不可靠

* **半同步定时**（2014）：结合两者优点



### 总线标准



**系统总线标准**：

* **ISA**（Industry Standard Architecture）：16位，8MHz

* **EISA**：32位扩展ISA

* **PCI**（Peripheral Component Interconnect）：32/64位，33/66MHz

* **PCI-E**：串行点对点，高速

* **AGP**：专用图形接口



**设备总线标准**：

* **USB**（Universal Serial Bus）：通用串行总线

* **IEEE1394**（FireWire）：高速串行

* **RS-232C**：串行通信标准



**总线桥接器**（2017）：

* 连接不同标准的总线

* 协议转换，速度匹配



### 总线操作与传输



**总线传输方式**：

* **并行传输**（2014）：多线同时传输

* **串行传输**：单线顺序传输

* **猝发传输**（2012）：连续传输多个数据



**信号线复用**（2016）：

* 数地复用（2012）：数据和地址共用线路

* 分时复用，提高线路利用率



**分离事务通信**（2016）：

* 请求和响应分离

* 提高总线利用率



## 4.2 输入输出系统



### I/O编址方式



**统一编址（内存映射I/O）**：

* I/O端口和内存统一编址

* 使用访存指令访问I/O

* 优点：指令丰富，控制简单

* 缺点：占用内存地址空间



**独立编址**（2014）：

* I/O端口单独编址

* 专用I/O指令（IN/OUT）

* 优点：不占内存空间，速度快

* 缺点：指令少，控制复杂



**I/O端口**：

* **数据端口**：传输数据

* **状态端口**：读取设备状态

* **控制端口**：发送控制命令



### I/O控制方式



**程序查询方式**：

1. 读取设备状态寄存器

2. 若设备未就绪，继续轮询

3. 设备就绪后传输数据



**思想**：CPU轮询设备状态

**复杂度**：$O(n)$，CPU利用率低



**中断方式**：

* 设备就绪时发出中断请求

* CPU响应中断，执行中断服务程序

* 优点：CPU可与I/O并行

* 缺点：中断处理开销大



**DMA方式**（Direct Memory Access）：

* 直接内存访问，不需要CPU介入

* DMA控制器管理传输

* 传输方式：

    * **周期挪用**（2020）：DMA窃取CPU周期

    * **停止CPU**：独占总线

    * **交替访问**：时间片轮转

* DMA预处理和后处理（2018）：CPU设置参数和善后



**通道方式**：

* 专用I/O处理器

* 执行通道程序

* 进一步减轻CPU负担



### I/O接口与设备



**接口功能**：

* 数据缓冲：协调速度差异

* 错误检测：奇偶校验等（2013）

* 控制定时：协调数据传输

* 数据格式转换：串并转换等



**常见接口设备**：

* **键盘控制器**（2021-2025）：扫描码转换

* **网络适配器**（网卡，2021-2025）：网络通信

* **打印机适配器**（2021-2025）：打印控制

* **可编程中断控制器**（PIC，2021-2025）：管理中断



**显存带宽计算**（2010）：

$\text{显存带宽} = \text{分辨率} \times \text{颜色深度} \times \text{刷新率}$

例如：1920×1080×32bit×60Hz ≈ 4.0GB/s



## 4.3 外部存储设备



### 磁盘存储器



**磁盘结构**：

* **盘面**（2021-2025）：双面盘片有两个盘面

* **磁道**（2021-2025）：同心圆轨迹

* **扇区**（2013）：磁道分段

* **柱面**：同半径的磁道集合



**磁盘性能指标**：

* **道密度**：沿半径方向单位长度的磁道数

* **位密度**：磁道单位长度存储的位数

* **存储容量**：$C = n \times s \times b$

$n$：盘面数，$s$：每面磁道数，$b$：每道扇区数×每扇区字节数



**磁盘访问时间**（2015）：

$T_a = T_s + \frac{1}{2r} + \frac{b}{rN}$

$T_s$：平均寻道时间，$r$：转速，$b$：传输字节数，$N$：每道字节数



**磁盘调度算法**：

* **FCFS**：先来先服务

* **SSTF**：最短寻道时间优先

* **SCAN**：电梯算法

* **C-SCAN**：循环扫描

* **LOOK/C-LOOK**：改进的SCAN/C-SCAN



**磁盘阵列技术**：

* **条带化**（2013）：数据分块分布到多个磁盘

* **磁盘镜像**（2013）：RAID 1，数据复制

* **奇偶校验**（2013）：RAID 5，分布式校验