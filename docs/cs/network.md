<script>

window.MathJax = {

  tex: {

    inlineMath: [['$', '$'], ['\\(', '\\)']],

    displayMath: [['$$', '$$'], ['\\[', '\\]']],

    macros: {

      oiint: "{\\mathchoice{\\mkern-18mu\\iint}{\\mkern-12mu\\iint}{\\mkern-13mu\\iint}{\\mkern-12mu\\iint}}"

    }

  }

};

</script>

<script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script>







# 一、网络体系结构与协议







## ISO/OSI参考模型（7层）







**层次结构与功能：**



1. **物理层**：比特传输，机械/电气/功能/规程特性



2. **数据链路层**：帧传输，差错控制，流量控制，MAC寻址



3. **网络层**：分组传输，路由选择，拥塞控制，IP编址



4. **传输层**：端到端通信，可靠传输，流量控制，复用/分用



5. **会话层**：建立/管理/终止会话



6. **表示层**：数据格式转换，加密解密，压缩解压



7. **应用层**：为用户提供网络服务接口







**易错点：**会话层和表示层在实际网络（TCP/IP）中很少单独实现，通常并入应用层







## TCP/IP参考模型（4/5层）







**层次结构：**



| 层次 | 协议示例 | 数据单元 |



|------|----------|----------|



| 应用层 | HTTP, FTP, SMTP, DNS | 报文/消息 |



| 传输层 | TCP, UDP | 段/数据报 |



| 网络层 | IP, ICMP, ARP | 分组/数据报 |



| 网络接口层 | Ethernet, PPP | 帧 |







**与OSI对比：**



* TCP/IP更简洁实用，OSI更理论化



* TCP/IP网络层只提供无连接服务



* TCP/IP在设计时就考虑了异构网络互联







# 二、物理层







## 传输介质与编码







**导向传输介质：**



* **双绞线**：UTP（非屏蔽，常用Cat5e、Cat6）、STP（屏蔽）



* **同轴电缆**：基带同轴（50Ω）、宽带同轴（75Ω）



* **光纤**：



    * 单模光纤：芯径小（8-10μm），传输距离远（可达100km）



    * 多模光纤：芯径大（50-62.5μm），传输距离短（2km以内）







**编码方式：**



| 编码 | 描述 | 优点 | 缺点 |



|------|------|------|------|



| NRZ | 不归零制 | 简单 | 无时钟同步 |



| NRZI | 不归零反转 | 差分编码抗干扰 | 长0序列失同步 |



| 曼彻斯特 | 位中间跳变 | 自同步 | 带宽加倍 |



| 差分曼彻斯特 | 位开始跳变 | 抗干扰强 | 复杂 |







## 性能指标与定理







**重要公式：**



1. **Nyquist定理**：$C = 2B \log_2 M$



    * $C$：无噪声信道极限速率



    * $B$：带宽（Hz）



    * $M$：信号状态数







2. **Shannon定理**：$C = B \log_2(1 + S/N)$



    * $S/N$：信噪比，常用dB表示：$10\log_{10}(S/N)$



    * 实际应用取较小值：$C_{\text{实际}} = \min(C_{\text{Nyquist}}, C_{\text{Shannon}})$







3. **时延计算**：



    * 发送时延：$T_{\text{send}} = L/R$



    * 传播时延：$T_{\text{prop}} = D/V$



    * 处理时延：$T_{\text{proc}}$（通常忽略）



    * 排队时延：$T_{\text{queue}}$（随机）



    * 总时延：$T_{\text{total}} = T_{\text{send}} + T_{\text{prop}} + T_{\text{proc}} + T_{\text{queue}}$







**易错点：**



* 混淆发送时延和传播时延：发送时延与数据长度成正比，传播时延与距离成正比



* 时延带宽积 = 传播时延 × 带宽，表示链路上能容纳的比特数



* 吞吐量 = min(发送速率，链路带宽)，瓶颈在最小带宽处







## 调制与多路复用







**调制技术：**



* **ASK**：幅移键控，抗干扰差



* **FSK**：频移键控，抗干扰中等



* **PSK**：相移键控，抗干扰强



* **QAM**：正交幅度调制，$M=16,64,256$等







**多路复用：**



| 类型 | 原理 | 应用 | 特点 |



|------|------|------|------|



| FDM | 频率分割 | 有线电视，无线电 | 模拟信号 |



| TDM | 时间分割 | 数字电话，SDH | 同步/统计 |



| WDM | 波分复用 | 光纤通信 | 光的FDM |



| CDM | 码分复用 | CDMA移动通信 | 正交码序列 |







# 三、数据链路层







## 差错控制与帧结构







**CRC检错算法：**



1. 设生成多项式位数为n+1，数据后补n个0



2. 用生成多项式对补0后的数据进行模2除法



3. 余数作为校验码







**帧结构对比：**



| 帧类型 | 前导码 | 地址字段 | 类型/长度 | 校验和 |



|--------|--------|----------|-----------|--------|



| 以太网帧 | 7B前导码+1B帧首定界符 | 6B目的+6B源 | 2B类型/长度 | 4B CRC |



| PPP帧 | 1B标志(0x7E) | 1B地址(0xFF) | 1B控制(0x03) | 2B协议+2B CRC |







## MAC协议







**信道划分协议：**



* **TDMA**：固定时隙，无冲突但效率低



* **FDMA**：固定频段，无冲突但频谱利用率低



* **CDMA**：所有用户同时同频通信，码字正交







**随机访问协议：**



1. **ALOHA**：



    * 纯ALOHA：$S = Ge^{-2G}$，最大吞吐量18.4%



    * 时隙ALOHA：$S = Ge^{-G}$，最大吞吐量36.8%







2. **CSMA**：



    * 1-坚持CSMA：信道忙则持续监听



    * 非坚持CSMA：信道忙则随机等待



    * p-坚持CSMA：以概率p发送







3. **CSMA/CD（以太网）**：



    * 监听信道，空闲则发送



    * 边发送边检测冲突



    * 若检测到冲突，发送阻塞信号并停止发送



    * 执行二进制指数退避算法：第i次重传，随机等待$r \times 512$比特时间，$r \in [0, 2^{\min(i,10)}-1]$



    * 重传16次失败则报告错误







4. **CSMA/CA（无线）**：



    * 使用RTS/CTS握手



    * 三种帧间间隔：SIFS < PIFS < DIFS



    * 虚拟载波监听：NAV计数器







**重难点：**



* **最小帧长**：$L_{\min} = 2\tau \times R$，确保发送期间能检测冲突



* **争用期**：$2\tau$，即端到端往返时延



* 二进制指数退避：第$i$次重传，$r \in [0, 2^{\min(i,10)}-1]$



* CSMA/CD用于有线，CSMA/CA用于无线（隐蔽站问题）







## 局域网与交换机







**IEEE 802标准：**



| 标准 | 名称 | 速率 | 介质 |



|------|------|------|------|



| 802.3 | 以太网 | 10M/100M/1G/10G | 双绞线/光纤 |



| 802.11 | WiFi | 11M/54M/... | 无线 |



| 802.15 | 蓝牙 | 1M/2M/... | 无线 |







**网络设备对比：**



| 设备 | 工作层次 | 功能 | 冲突域 | 广播域 |



|------|----------|------|--------|--------|



| 集线器Hub | 物理层 | 信号放大转发 | 共享 | 共享 |



| 网桥Bridge | 数据链路层 | 帧过滤转发 | 分隔 | 共享 |



| 交换机Switch | 数据链路层 | 基于MAC转发 | 每个端口独立 | 共享 |



| 路由器Router | 网络层 | 路由选择 | 每个端口独立 | 分隔 |







**VLAN技术：**



* **端口VLAN**：基于交换机端口划分



* **MAC VLAN**：基于MAC地址划分



* **协议VLAN**：基于协议类型划分



* **802.1Q标签**：4字节，包含VLAN ID（12位）



# 四、网络层



## IP协议与编址



**IPv4数据报格式：**



| 字段 | 长度 | 说明 |

| :--- | :--- | :--- |

| 版本 | 4位 | IPv4=4，IPv6=6 |

| 首部长度 | 4位 | 以4字节为单位，最小5，最大15 |

| 区分服务 | 8位 | QoS优先级 |

| 总长度 | 16位 | 首部+数据，最大65535字节 |

| 标识 | 16位 | 分片标识 |

| 标志 | 3位 | MF（更多分片）、DF（不分片） |

| 片偏移 | 13位 | 以8字节为单位 |

| 生存时间TTL | 8位 | 跳数限制 |

| 协议 | 8位 | TCP=6，UDP=17，ICMP=1 |

| 首部检验和 | 16位 | 只检验首部 |

| 源/目的IP地址 | 各32位 | |



**分片计算：**

* MTU：最大传输单元，以太网为1500字节

* 分片数据长度 = MTU - IP首部长度（通常20字节）

* 片偏移 = (分片起始位置)/8

* MF=1表示还有后续分片，MF=0表示最后一个分片



## IP地址与子网划分



**地址分类：**



| 类 | 首字节 | 网络号长度 | 主机号长度 | 范围 |

| :--- | :--- | :--- | :--- | :--- |

| A | 1-126 | 8位 | 24位 | 1.0.0.0-126.255.255.255 |

| B | 128-191 | 16位 | 16位 | 128.0.0.0-191.255.255.255 |

| C | 192-223 | 24位 | 8位 | 192.0.0.0-223.255.255.255 |

| D | 224-239 | 组播地址 |  | 224.0.0.0-239.255.255.255 |

| E | 240-255 | 保留地址 |  | 240.0.0.0-255.255.255.255 |



**CIDR与子网划分：**

* CIDR表示法：IP地址/前缀长度，如192.168.1.0/24

* 子网掩码：连续1表示网络位，连续0表示主机位

* 可用主机数 = $2^{\text{主机位数}} - 2$（去掉网络地址和广播地址）

* 路由聚合：将多个小网络合并为一个大网络



**易错点：**

* 私有地址范围：A类10.0.0.0/8，B类172.16.0.0/12，C类192.168.0.0/16

* 特殊地址：127.0.0.1（环回），255.255.255.255（广播）

* 子网划分时，借位来自主机号部分

* 超网与CIDR：合并多个连续网络需要满足$2^n$个网络



## 路由协议



**路由算法对比：**



| 协议 | 类型 | 度量 | 更新方式 | 适用规模 |

| :--- | :--- | :--- | :--- | :--- |

| RIP | 距离向量 | 跳数 | 周期性广播 | 小型网络 |

| OSPF | 链路状态 | 代价 | 触发式泛洪 | 大型网络 |

| BGP | 路径向量 | 策略 | 增量更新 | 自治系统间 |



**RIP距离向量算法：**



```

Procedure RIP更新()

    初始化：距离向量D[v]=∞，下一跳N[v]=null

    D[self] = 0

Loop

    每隔30秒向邻居发送距离向量

    收到邻居u的距离向量Du

    ForAll 目的节点v

        If Du[v] + 1 < D[v]

            D[v] = Du[v] + 1

            N[v] = u

        EndIf

    EndFor

EndLoop

EndProcedure

```



**计数到无穷问题：**

* **毒性逆转**：向邻居通告到该邻居可达目的的距离为∞

* **触发更新**：路由变化时立即发送更新

* **水平分割**：不向邻居通告从该邻居学到的路由



## ARP与NAT



**ARP协议：**

* 功能：IP地址 → MAC地址映射

* ARP请求：广播，询问"谁的IP是X.X.X.X？"

* ARP响应：单播，回答"我的MAC是XX:XX:XX:XX:XX:XX"

* ARP缓存：保存IP-MAC映射，有生存时间



**NAT技术：**

* 静态NAT：一对一固定映射

* 动态NAT：从地址池分配临时映射

* NAPT（PAT）：多对一，使用端口号区分

* NAT转换表：记录(内部IP:端口, 外部IP:端口, 协议)



**重难点：**

* ARP只用于同一局域网，跨网络需要路由器转发

* NAT破坏端到端透明性，某些协议（如FTP、SIP）需要ALG支持

* NAT穿越技术：STUN、TURN、ICE



# 五、传输层



## UDP协议



**UDP数据报格式：**



| 字段 | 说明 |

| :--- | :--- |

| 源端口 | 16位，可选（0表示无） |

| 目的端口 | 16位 |

| 长度 | 16位，首部+数据 |

| 检验和 | 16位，可选（0表示无） |

| 数据 | 应用层数据 |



**UDP特点：**

* 无连接，不可靠，尽最大努力交付

* 首部开销小（8字节）

* 无拥塞控制，适合实时应用

* 支持一对一、一对多、多对多通信



## TCP协议与连接管理



**TCP段格式：**



| 字段 | 长度 | 说明 |

| :--- | :--- | :--- |

| 源端口/目的端口 | 各16位 |  |

| 序列号 | 32位 | 本报文段第一个字节的序号 |

| 确认号 | 32位 | 期望收到的下一个字节序号 |

| 数据偏移 | 4位 | TCP首部长度（以4字节为单位） |

| 控制位 | 6位 | URG/ACK/PSH/RST/SYN/FIN |

| 窗口大小 | 16位 | 接收窗口大小（流量控制） |

| 检验和 | 16位 |  |

| 紧急指针 | 16位 | URG=1时有效 |

| 选项 | 可变 | MSS、窗口扩大因子等 |



**TCP三次握手：**

1.  Client → Server：SYN=1, seq=x

2.  Server → Client：SYN=1, ACK=1, seq=y, ack=x+1

3.  Client → Server：ACK=1, seq=x+1, ack=y+1



**TCP四次挥手：**

1.  A → B：FIN=1, seq=u

2.  B → A：ACK=1, seq=v, ack=u+1

3.  B → A：FIN=1, ACK=1, seq=w, ack=u+1

4.  A → B：ACK=1, seq=u+1, ack=w+1



**状态转换易错点：**

* TIME_WAIT：主动关闭方等待2MSL（60秒）

* CLOSE_WAIT：被动关闭方等待应用层关闭

* SYN_RECEIVED：收到SYN，发送SYN+ACK后状态

* 半关闭状态：FIN_WAIT_1/2



## 可靠数据传输协议



**停等协议：**

* 发送窗口=1，接收窗口=1

* 信道利用率：$U = \frac{T_{\text{data}}}{T_{\text{data}} + 2T_{\text{prop}}}$



**回退N帧（GBN）：**



```

Procedure GBN发送方()

    base ← 1 //发送窗口下界

    nextseqnum ← 1 //下一个要发送的序号

Loop

    If 有数据发送且窗口未满

        发送序号为nextseqnum的分组

        nextseqnum ← nextseqnum + 1

    EndIf

    If 收到ACK n

        base ← n + 1

        If base == nextseqnum

            停止定时器

        Else

            重启定时器

        EndIf

    EndIf

    If 超时

        重传所有未确认分组（base到nextseqnum-1）

        重启定时器

    EndIf

EndLoop

EndProcedure

```



**选择重传（SR）：**

* 发送窗口和接收窗口大小相同

* 接收方缓存乱序到达的分组

* 只重传丢失的分组

* 窗口大小限制：$W_{\text{send}} + W_{\text{recv}} \leq 2^n$



**窗口计算：**

* GBN：发送窗口$W_T \leq 2^n - 1$，接收窗口$W_R = 1$

* SR：$W_T = W_R = 2^{n-1}$

* 比特数$n$满足：$2^{n-1} \geq W_T + W_R$（避免序号回绕）



## 流量控制与拥塞控制



**流量控制（滑动窗口）：**

* 接收方通过rwnd字段通告可用缓冲区大小

* 发送方保证：LastByteSent - LastByteAcked ≤ rwnd

* 零窗口探测：发送1字节探测报文



**TCP拥塞控制算法：**

1.  **慢启动**：cwnd从1开始，每RTT翻倍

2.  **拥塞避免**：cwnd达到ssthresh后，每RTT加1

3.  **快速重传**：收到3个重复ACK，ssthresh=cwnd/2，cwnd=ssthresh+3

4.  **快速恢复**：重传丢失分组，每收到一个ACK，cwnd加1



**AIMD（加性增乘性减）：**

* 加性增：每个RTT，cwnd增加1 MSS

* 乘性减：发生超时时，cwnd减半



# 六、应用层



## DNS域名系统



**查询过程：**

1.  递归查询：客户端→本地DNS→根DNS→顶级DNS→权威DNS

2.  迭代查询：DNS服务器只返回下一跳地址



**资源记录类型：**



| 类型 | 代码 | 功能 |

| :--- | :--- | :--- |

| A | 1 | IPv4地址 |

| AAAA | 28 | IPv6地址 |

| CNAME | 5 | 规范名（别名） |

| MX | 15 | 邮件交换 |

| NS | 2 | 域名服务器 |



## 电子邮件协议



**协议体系：**

* **SMTP**（25端口）：发送邮件，推协议，只支持7位ASCII

* **POP3**（110端口）：下载邮件到本地，删除服务器副本

* **IMAP**（143端口）：在线操作邮件，同步状态

* **MIME**：扩展支持非ASCII、附件等



## HTTP协议



**HTTP方法：**



| 方法 | 功能 |

| :--- | :--- |

| GET | 获取资源 |

| POST | 提交数据 |

| PUT | 上传资源 |

| DELETE | 删除资源 |

| HEAD | 获取头部 |



**HTTP连接：**

* **非持久连接**：每个对象单独建立TCP连接

* **持久连接**：多个对象使用同一连接

* **流水线**：连续发送请求，无需等待响应



**HTTP报文格式：**

```

请求行：方法 URL 版本

首部行：Host: www.example.com

Connection: keep-alive

Cookie: name=value

空行

实体主体：POST数据等

```



## FTP文件传输



**双连接模式：**

* **控制连接**（21端口）：传输命令，持久连接

* **数据连接**（20端口）：传输数据，按需建立

* **主动模式**：服务器主动连接客户端数据端口

* **被动模式**：客户端连接服务器数据端口



# 七、历年真题重点解析（2009-2025）



**2009**

* **OSI七层模型**：各层详细功能与协议

* **噪声与信噪比计算**：Shannon定理应用

* **GBN协议**：发送窗口大小计算，信道利用率

* **CSMA/CD**：最小帧长，争用期计算

* **TCP**：序列号、确认号、超时重传机制

* **FTP**：控制连接与数据连接区分



**2010**

* **分组交换**：存储转发时延计算

* **RIP协议**：距离矢量，计数到无穷问题

* **ICMP报文**：目的不可达、超时、重定向

* **子网划分**：定长子网掩码计算

* **广播风暴**：产生原因与防止

* **以太网帧**：前导码作用，帧结构



**2011**

* **TCP/IP模型**：四层结构与对应协议

* **调制技术**：ASK、FSK、PSK对比

* **MAC协议**：CSMA、CDMA、CSMA/CA区别

* **TCP三次握手**：SYN、ACK标志位，序列号变化

* **MTU与分片**：IP分组分片计算

* **CRC校验**：生成多项式计算校验码



**2012**

* **PPP协议**：帧结构，LCP/NCP协议

* **物理层特性**：机械/电气/功能/规程

* **路由表**：下一跳转发，最长前缀匹配

* **ARP协议**：IP到MAC地址解析

* **电子邮件**：SMTP/POP3工作原理

* **TCP段头**：六个控制位含义



**2013-2015**

* **10BaseT以太网**：拓扑结构，传输介质

* **多路复用**：FDMA/TDMA/WDM应用

* **交换机转发**：直通交换与存储转发

* **自治系统**：IGP与EGP区别

* **编码方式**：NRZ、曼彻斯特、差分曼彻斯特

* **DHCP协议**：Discover/Offer/Request/ACK四步



**2016-2018**

* **交换机与集线器**：冲突域与广播域

* **距离向量收敛**：好消息快，坏消息慢

* **DNS查询**：递归与迭代查询过程

* **TCP连接管理**：状态转换图

* **封装与分用**：各层协议数据单元

* **校验和计算**：二进制反码求和



**2019-2021**

* **传输介质**：双绞线、光纤、同轴电缆比较

* **快速重传**：三个重复ACK触发

* **VLAN技术**：802.1Q标签，Trunk链路

* **NAT技术**：静态NAT、动态NAT、NAPT

* **HTTP协议**：持久连接与非持久连接

* **TCP状态**：TIME_WAIT、CLOSE_WAIT意义



**2022-2025**

* **SDN架构**：数据平面、控制平面、北向接口

* **IPv6协议**：地址格式，首部简化

* **QAM调制**：16-QAM、64-QAM星座图

* **二进制指数退避**：算法过程，争用时间片计算

* **BGP协议**：路径向量，策略路由

* **拥塞控制**：AIMD原理，公平性分析



# 八、典型计算题解析



**例题1：时延计算综合题**

某网络链路长1000km，带宽10Mbps，信号传播速度$2\times10^8$m/s，分组长度1000字节。求：

1.  发送时延：$T_s = \frac{1000\times8}{10\times10^6} = 0.8ms$

2.  传播时延：$T_p = \frac{1000\times1000}{2\times10^8} = 5ms$

3.  总时延：$T = T_s + T_p = 5.8ms$（忽略处理排队时延）

4.  时延带宽积：$B\times T_p = 10\times10^6\times5\times10^{-3} = 50kb$



**例题2：子网划分与路由聚合**

给定地址块192.168.0.0/22，需要划分为8个子网，每个子网至少60台主机。

1.  主机位需要满足：$2^h - 2 \geq 60 \Rightarrow h \geq 6$

2.  网络位：$32 - 6 = 26$位

3.  子网掩码：255.255.255.192

4.  子网地址：192.168.0.0/26, 192.168.0.64/26, ..., 192.168.3.128/26

5.  路由聚合：8个子网可聚合为192.168.0.0/21



**例题3：GBN协议效率计算**

信道带宽1Gbps，端到端时延10ms，分组大小1KB，GBN发送窗口大小1000。

1.  发送一个分组时间：$T_{\text{send}} = \frac{1024\times8}{10^9} = 8.192\mu s$

2.  传播时延：$T_{\text{prop}} = 10ms = 10000\mu s$

3.  信道利用率：$U = \frac{W\times T_{\text{send}}}{T_{\text{send}}+2T_{\text{prop}}} = \frac{1000\times8.192}{8.192+20000} \approx 40.9\%$



## 附录：重要公式速查



| 名称 | 公式 | 说明 |

| :--- | :--- | :--- |

| Nyquist定理 | $C = 2B\log_2 M$ | 无噪声极限速率 |

| Shannon定理 | $C = B\log_2(1+S/N)$ | 有噪声极限速率 |

| 发送时延 | $T_s = L/R$ | 数据长度/带宽 |

| 传播时延 | $T_p = D/V$ | 距离/传播速度 |

| 时延带宽积 | $B \times T_p$ | 链路上比特数 |

| ALOHA吞吐量 | $S = Ge^{-2G}$ | 纯ALOHA |

| 时隙ALOHA吞吐量 | $S = Ge^{-G}$ | 时隙ALOHA |

| 最小帧长 | $L_{\min} = 2\tau R$ | 确保冲突检测 |

| GBN窗口大小 | $W_T \leq 2^n - 1$ | n为序号比特数 |

| SR窗口大小 | $W_T = W_R = 2^{n-1}$ | 避免序号歧义 |