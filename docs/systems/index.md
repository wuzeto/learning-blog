<script>

window.MathJax = {

  tex: {

    inlineMath: [['$', '$'], ['\\(', '\\)']],

    displayMath: [['$$', '$$'], ['\\[', '\\]']],

    macros: {

      oiint: "{\\mathchoice{\\mkern-18mu\\iint}{\\mkern-12mu\\iint}{\\mkern-13mu\\iint}{\\mkern-12mu\\iint}}"

    }

  }

};

</script>

<script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script>



# 三、中央处理器



## 3.1 指令系统



### 指令格式与类型



**指令组成**：

* 操作码字段：指定操作类型

* 地址码字段：指定操作数地址



**指令字长与存储字长**：

* 定长指令字（2013）：所有指令长度相同

* 变长指令字：指令长度不同，节省空间但控制复杂



**地址码数量**（2015，2021-2025）：

* **零地址指令**：操作数隐含（如栈操作）

* **单地址指令**：$OP(A) \to A$

* **二地址指令**：$OP(A,B) \to A$

* **三地址指令**：$OP(A,B,C) \to C$



**指令类型**：

* **传送指令**：MOV， LOAD， STORE

* **算术指令**：ADD， SUB， MUL， DIV

* **移位指令**：逻辑移位、算术移位（2018）

* **转移指令**：

    * 无条件转移：JMP

    * 条件转移：JZ， JC

    * 调用：CALL

    * 返回：RET

    * 陷阱：TRAP（2015）

* **I/O指令**：IN， OUT

* **特权指令**：内核态执行



### 寻址方式（2009-2016）



**立即寻址**：操作数在指令中

* 优点：速度快

* 缺点：操作数范围受限



**直接寻址**：地址在指令中

$EA = A$



**间接寻址**：指令中地址的地址

$EA = (A)$



**寄存器寻址**：操作数在寄存器

$EA = R$



**寄存器间接寻址**：寄存器存地址

$EA = (R)$



**基址寻址**（2014）：

$EA = (BR) + A$

BR：基址寄存器，A：形式地址



**变址寻址**（2013）：

$EA = (IX) + A$

IX：变址寄存器



**先变址后间址**（2016）：

$EA = ((IX) + A)$



**相对寻址**（2009）：

$EA = (PC) + A$

PC：程序计数器



**堆栈寻址**：操作数在堆栈顶

* 隐含寻址：操作数地址隐含给出

* 如：PUSH， POP指令



### 指令集架构（ISA，2017）



**CISC特点**：

* 指令复杂，长度可变

* 寻址方式多样

* 微程序控制

* 代表：x86



**RISC特点**：

* 指令简单，长度固定

* 寻址方式少

* 硬布线控制

* 大量寄存器

* 代表：ARM， MIPS



**汇编语言与硬件描述语言**（2015）：

* 汇编语言：符号化机器语言

* 硬件描述语言：描述数字电路（VHDL， Verilog）



## 3.2 CPU数据通路与控制



### 数据通路（2010）



**专用数据通路**（2021-2025）：

* 各部件专用连接线

* 性能高，成本高



**单总线数据通路**（2015）：

* 所有部件共享一条总线

* 结构简单，成本低

* 性能受总线带宽限制



**多总线数据通路**（2017）：

* 多条总线，提高并行性

* 如：指令总线、数据总线、IO总线



**数据通路组成**：

* 运算部件：ALU，移位器（2020）

* 存储部件：寄存器文件，暂存器（2015）

* 传输部件：多路选择器，总线

* 控制部件：产生控制信号



### 控制器设计



**硬布线控制器**（2009，2021-2025）：

* 组合逻辑电路实现控制信号生成

* 速度快，设计复杂

* 微架构（2021-2025）：硬件实现细节



**微程序控制器**：

* 微指令序列实现指令功能

* 设计灵活，速度较慢



**控制信号生成**：

1. 译码指令操作码

2. 根据状态机状态

3. 结合条件码（条件转移时）

4. 生成对应的控制信号集合



**思想**：状态机控制指令执行步骤

**复杂度**：$O(1)$，硬件并行实现



**有效控制信号**（2009）：

* 时钟信号：同步时序

* 读写控制：MEMR， MEMW， IOR， IOW

* 寄存器控制：RegWrite， RegRead

* ALU控制：ALUOp



### 指令执行过程



**指令周期**：

* **取指周期**：取指令，PC+1

* **间址周期**：取有效地址（如果需要）

* **执行周期**：执行操作

* **中断周期**：处理中断（如果有）



**典型指令执行**：

1. **LOAD指令**：取指→计算地址→访存→写寄存器

2. **STORE指令**：取指→计算地址→读寄存器→访存

3. **ADD指令**：取指→读寄存器→ALU运算→写寄存器

4. **转移指令**：取指→计算目标地址→更新PC



**数据相关与冒险**（2016）：

* **RAW**（写后读）：真相关，最常见

* **WAR**（读后写）：名相关，寄存器重命名解决

* **WAW**（写后写）：名相关



**解决方案**：

* **前递（旁路）**：将结果直接转发给需要指令

* **停顿（插气泡）**（2021-2025）：插入空操作

* **重排序**：编译器或硬件重排指令



## 3.3 流水线技术



### 流水线基本概念



**流水线阶段划分**：

* IF：取指令

* ID：指令译码，读寄存器

* EX：执行/地址计算

* MEM：访存

* WB：写回结果



**流水线性能指标**：

* **吞吐率**$TP$：单位时间完成指令数

$TP = \frac{n}{(k+n-1)\Delta t}$

$n$：指令数，$k$：段数，$\Delta t$：时钟周期

* **加速比**$S$：$S = \frac{T_{\text{非流水}}}{T_{\text{流水}}}$

* **效率**$E$：$E = \frac{n}{k+n-1}$



**流水线冲突**：

* **结构冲突**：资源竞争

* **数据冲突**：数据相关

* **控制冲突**：转移指令引起



### 高级流水线技术



**超标量流水线**（2017）：

* 多个功能部件，同时发射多条指令

* 需要多端口寄存器文件

* 依赖动态调度（2017）



**动态调度算法**：

1. 检查指令队列

2. 检查指令间相关性和资源可用性

3. 若无相关且资源可用，发射指令并更新资源状态；否则停顿等待



**思想**：硬件动态检测和解决相关

**复杂度**：$O(n)$，硬件实现



**超长指令字（VLIW）**：

* 编译器静态调度

* 一条长指令包含多个操作

* 硬件简单，编译复杂



**多核处理器**（2021-2025）：

* 多个核心集成在一个芯片

* 共享或私有Cache

* 需要解决缓存一致性问题



**向量处理器**（2021-2025）：

* 单指令多数据（SIMD）

* 适合科学计算

* 如：GPU，Intel AVX



**硬件多线程**（2021-2025）：

* 细粒度：每个周期切换线程

* 粗粒度：发生停顿时切换

* 同时多线程（SMT）：如Intel超线程



## 3.4 异常与中断



### 中断系统



**中断分类**（2015）：

* **外中断**（2009）：IO完成，时钟中断

* **内异常**：

    * 故障（Fault）：可恢复，如缺页

    * 陷阱（Trap）：有意异常，如系统调用

    * 终止（Abort）：不可恢复，如硬件错误



**中断处理过程**：

1. 关中断，保存现场

2. 识别中断源，获取中断类型号（2011）

3. 执行中断服务程序（2010）

4. 恢复现场，开中断，返回



**中断隐指令**（2012）：

* 硬件自动执行的操作

* 保存PC和状态寄存器

* 关中断，转入中断处理程序



**中断屏蔽**（2011）：

* 中断屏蔽字：控制哪些中断可响应

* 优先级：高优先级中断可打断低优先级



**多重中断**（2017）：

* 中断嵌套处理

* 需要保存多层现场

* 实现方式：中断屏蔽或硬件堆栈



**单重中断**（2021-2025）：

* 处理中断时关中断

* 简单，无嵌套