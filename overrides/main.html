{% extends "base.html" %}

{% block content %}
  {% if page.meta and page.meta.hide %}
    {% set hidden = "hidden" if "navigation" in page.meta.hide %}
  {% endif %}

  {{ super() }}

  <!-- æ·»åŠ è¯„è®ºåŒºï¼ˆåªåœ¨éé¦–é¡µæ˜¾ç¤ºï¼‰ -->
  {% if page.url != "" and page.url != "index.html" %}
    <div class="comments-section" style="margin-top: 3rem; padding-top: 2rem; border-top: 1px solid var(--md-default-fg-color--lightest);">
      <h2>ğŸ“ è¯„è®ºåŒº</h2>
      {% include "comments.html" %}
    </div>
  {% endif %}

  <!-- æ·»åŠ è‡ªå®šä¹‰ä¸»é¢˜è‰²é€‰æ‹©å™¨ -->
  <div class="color-picker-container" style="position: fixed; bottom: 2rem; right: 2rem; z-index: 1000;">
    <button id="color-picker-toggle" class="md-button md-button--primary" style="border-radius: 50%; width: 48px; height: 48px; background: var(--md-primary-fg-color); color: white; border: none; cursor: pointer; box-shadow: 0 4px 12px rgba(0,0,0,0.2);">
      <i class="fas fa-palette"></i>
    </button>
    <div id="color-picker-menu" style="display: none; position: absolute; bottom: 60px; right: 0; background: var(--md-default-bg-color); border: 1px solid var(--md-default-fg-color--lightest); border-radius: 8px; padding: 12px; min-width: 150px; box-shadow: 0 4px 12px rgba(0,0,0,0.15);">
      <h4 style="margin-top: 0; margin-bottom: 8px; font-size: 0.9rem; color: var(--md-default-fg-color);">ä¸»é¢˜è‰²</h4>
      <div class="color-options" style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px;">
        <button class="color-option" data-color="cyan" style="width: 32px; height: 32px; background: #00bcd4; border: none; border-radius: 50%; cursor: pointer;"></button>
        <button class="color-option" data-color="indigo" style="width: 32px; height: 32px; background: #3f51b5; border: none; border-radius: 50%; cursor: pointer;"></button>
        <button class="color-option" data-color="green" style="width: 32px; height: 32px; background: #4caf50; border: none; border-radius: 50%; cursor: pointer;"></button>
        <button class="color-option" data-color="orange" style="width: 32px; height: 32px; background: #ff9800; border: none; border-radius: 50%; cursor: pointer;"></button>
        <button class="color-option" data-color="pink" style="width: 32px; height: 32px; background: #e91e63; border: none; border-radius: 50%; cursor: pointer;"></button>
        <button class="color-option" data-color="purple" style="width: 32px; height: 32px; background: #9c27b0; border: none; border-radius: 50%; cursor: pointer;"></button>
        <button class="color-option" data-color="teal" style="width: 32px; height: 32px; background: #009688; border: none; border-radius: 50%; cursor: pointer;"></button>
        <button class="color-option" data-color="blue" style="width: 32px; height: 32px; background: #2196f3; border: none; border-radius: 50%; cursor: pointer;"></button>
      </div>
    </div>
  </div>
{% endblock %}

{% block scripts %}
  {{ super() }}
  
  <script>
    // ä¸»é¢˜è‰²åˆ‡æ¢åŠŸèƒ½
    document.addEventListener('DOMContentLoaded', function() {
      const toggleButton = document.getElementById('color-picker-toggle');
      const colorMenu = document.getElementById('color-picker-menu');
      const colorOptions = document.querySelectorAll('.color-option');
      
      // åˆ‡æ¢é¢œè‰²é€‰æ‹©å™¨æ˜¾ç¤º
      toggleButton.addEventListener('click', function(e) {
        e.stopPropagation();
        colorMenu.style.display = colorMenu.style.display === 'none' ? 'block' : 'none';
      });
      
      // ç‚¹å‡»é¡µé¢å…¶ä»–åŒºåŸŸå…³é—­é€‰æ‹©å™¨
      document.addEventListener('click', function(e) {
        if (!colorMenu.contains(e.target) && e.target !== toggleButton) {
          colorMenu.style.display = 'none';
        }
      });
      
      // è®¾ç½®ä¸»é¢˜è‰²
      colorOptions.forEach(option => {
        option.addEventListener('click', function() {
          const color = this.getAttribute('data-color');
          setThemeColor(color);
          localStorage.setItem('theme-color', color);
          colorMenu.style.display = 'none';
        });
      });
      
      // ä»localStorageåŠ è½½ä¿å­˜çš„ä¸»é¢˜è‰²
      const savedColor = localStorage.getItem('theme-color');
      if (savedColor) {
        setThemeColor(savedColor);
      }
      
      // è®¾ç½®ä¸»é¢˜è‰²çš„å‡½æ•°
      function setThemeColor(color) {
        const root = document.documentElement;
        
        // æ ¹æ®é¢œè‰²è®¾ç½®CSSå˜é‡
        const colors = {
          cyan: {
            primary: '#00bcd4',
            accent: '#7c4dff'
          },
          indigo: {
            primary: '#3f51b5',
            accent: '#ff4081'
          },
          green: {
            primary: '#4caf50',
            accent: '#ff9800'
          },
          orange: {
            primary: '#ff9800',
            accent: '#3f51b5'
          },
          pink: {
            primary: '#e91e63',
            accent: '#00bcd4'
          },
          purple: {
            primary: '#9c27b0',
            accent: '#4caf50'
          },
          teal: {
            primary: '#009688',
            accent: '#ff5722'
          },
          blue: {
            primary: '#2196f3',
            accent: '#ff9800'
          }
        };
        
        if (colors[color]) {
          root.style.setProperty('--md-primary-fg-color', colors[color].primary);
          root.style.setProperty('--md-primary-fg-color--dark', this.darkenColor(colors[color].primary, 0.2));
          root.style.setProperty('--md-accent-fg-color', colors[color].accent);
          root.style.setProperty('--md-accent-fg-color--transparent', this.hexToRGBA(colors[color].accent, 0.1));
          
          // æ›´æ–°æŒ‰é’®é¢œè‰²
          toggleButton.style.background = colors[color].primary;
        }
      }
      
      // è¾…åŠ©å‡½æ•°ï¼šåŠ æ·±é¢œè‰²
      function darkenColor(color, percent) {
        const num = parseInt(color.replace("#", ""), 16),
          amt = Math.round(2.55 * percent * 100),
          R = (num >> 16) - amt,
          G = (num >> 8 & 0x00FF) - amt,
          B = (num & 0x0000FF) - amt;
        return "#" + (0x1000000 + (R < 255 ? R < 1 ? 0 : R : 255) * 0x10000 + 
          (G < 255 ? G < 1 ? 0 : G : 255) * 0x100 + (B < 255 ? B < 1 ? 0 : B : 255))
          .toString(16).slice(1);
      }
      
      // è¾…åŠ©å‡½æ•°ï¼šè½¬æ¢ä¸ºRGBA
      function hexToRGBA(hex, alpha) {
        const r = parseInt(hex.slice(1, 3), 16),
              g = parseInt(hex.slice(3, 5), 16),
              b = parseInt(hex.slice(5, 7), 16);
        return `rgba(${r}, ${g}, ${b}, ${alpha})`;
      }
    });
  </script>
{% endblock %}